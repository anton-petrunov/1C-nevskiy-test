# Тестовое задание для ООО "Невский"
## Краткое описание
Была выполнена доработка обработки в соответствии с техническим заданием. Файл актуальной версии обработки представлен ниже:

[AntonPetrunovNevskiyTest_1_0_0_21.zip](https://github.com/anton-petrunov/1C-nevskiy-test/files/12996414/AntonPetrunovNevskiyTest_1_0_0_21.zip)

Т.к. `GitHub` в файле документации `README.md` не поддерживает загрузку файлов внешней обработки 1С `.epf`, то этот файл поставляется в архиве `.zip`.

## Техническое задание
Во вложении тестовая обработка, которую необходимо доработать следующим функционалом:
1. Сформировать дерево (команда `"Заполнить дерево"`), заполнив его колонками `"Значение числа"` - генератор случайных чисел (от 1 до 100), колонка `Значение Даты` - к `ДатыВыполнения + ЗначениеЧисла`. Всего должно быть `100` записей;
2. Результат в дереве сгруппировать согласно полю `ГруппировкаДерева`;
3. Сортировка дерева - сортировать дерево согласно Группировки результата (`ГруппировкаДерева`);
4. "Ваше творчество" - чтобы Вы еще добавили к этой обработке (к поставленной задаче). Это не обязательно.

Время выполнения неограниченно. Методы, способы выполнения задачи не регламентированы (Тех.платформа `8.3.18`, БСП `2.16`). Если сделаете различные варианты формирования дерева - будет даже очень хорошо!
## Используемые технологии
- Платформа  `1С: Предприятие 8.3, учебная версия (8.3.22.1851)` в режиме совместимости с версией `8.3.18` (согласно требованию ТЗ)
- `1С: EDT` (*только* для публикации проекта на GitHub)
## Запуск проекта 
1. Скачайте файл с архивом `AntonPetrunovNevskiyTest_1_0_0_21.zip` из [пункта выше](https://github.com/anton-petrunov/1C-nevskiy-test#краткое-описание).
2. Распакуйте архив, в нем находится файл с обработкой `ТестовоеЗаданиеАнтонаПетрунова_1_0_0_21.epf`
3. Далее выбирете вариант использования файла: как пользователь, или как программист
	1. Если вы выбрали режим пользователя:
 		- Откройте "чистую" базу 1С (хотя подойдет любая база, т.к. обработка *не внесет* в нее никаких изменений)
   		- В правом верхнем углу нажмите на выпадающее меню со стрелкой и выберите пункт "Открыть файл"

............
## Что было реализовано
1. В соответствии с п. 1 ТЗ по нажатию кнопки `Заполнить Дерево` было выполнено формирование и заполнение дерева с колонками `ЗначениеЧисла` и `ЗначениеДаты` числами и датами соответственно
2. В соответствии с п. 2 ТЗ: 
* Была выполнена автоматическая группировка дерева в соответствии с положением тумблера, который связан с реквизитом формы `ГруппировкаДерева`
* При этом группировка дерева происходит автоматически при изменении значения этого реквизита (это реализовано как событие `ПриИзменении` элемента формы `ГруппировкаДерева`
* Что важно при перегруппировке дерева в результате переключения тумблера `Группировка Дерева`, - __порядок следования__ элементов исходного дерева __сохраняется__
* Для исключения лишнего вызова сервера при пустом дереве, была добавлена проверка на заполненность элемента формы этого дерева на клиенте с выводом соответствующего информационного сообщения
3. В соответствии с п. 3 ТЗ: 
* При нажатии кнопки `Сортировать Дерево` происходит сортирока дерева по возрастанию по той колонке, по которой уже выполнена группировка.
* При этом, чтобы сортировка по числовым значениям выполнялась корректно, был изменен тип колонки `ЗначениеЧисла` с типа `Строка` на тип `Число`. Без этого изменения сортировка осуществлялась по возрастанию индексов порядка положения символов в таблице кодировки, что для числовых данных работало некорректно
* Также как и с элементом формы `ГруппировкаДерева` для исключения серверного вызова при пустом дереве на форме, была реализована проверка на пустоту формы дерева на клиенте. И также выводится информационное сообщение
4. "Моё творчество" и пункт без номера
* Изначально я реализовал и группировку дерева, и его сортировку менее эффективым способом, чем сейчас. В нем формирование группировки было осуществлено с помощью промежуточного `Соответствия массивов`, принимающего на вход значения и выполняющего группировку в зависимости от `ГруппировкаДерева`
* Я хотел убрать этот кусок функционала и кода из программы, но потом прочитал пункт задания без номера, и решил оставить его, т.к. он точно соответствует этому пожеланию
* В итоге я вставил на форму подменю `Сгруппировать дерево`, где разместил две команды: `Сгруппировать дерево` и `Сгруппировать дерево, используя соответствие`
* Также я изменил внешний вид элемента формы, связанного с реквизитом формы `ГруппировкаДерева` с типа `ПолеВвода` на тип `ПолеПереключателя (Тумблер)`. Это повысило наглядность формы и удобство её использования.
* Помимо этого я поместил на форму подменю "Очистить дерево". В его состав я включил команды: `Очистить дерево (все данные на сервере)` и `Очистить дерево (только форму на клиенте)`.
	* Разница в этих командах в том, что очистка формы на клиенте происходит без вызова сервера, и поэтому значительно быстрее, чем при вызове сервера, преобразовании данных формы в объект `ДеревоЗначений`, очистке дерева и обратому преобразованию пустого дерева. 
	- `Замер производительности` показал относителные средние значения очистки на клиенте и на сервере для 100 строк дерева: `~ 0,4 мс` на клиенте против `~ 23 мс` на сервере
	- Конечно, при такой быстрой очистке данные остаются на сервере, и при перезагрузке формы вернутся на место. Но в нашем конкретном случае данные нигде не хранятся на сервере, поэтому этот способ вполне решает задачу очистки
	- Для защиты данных пользователя в поведение формы при очистке были встроены `Асинхронные диалоговые окна` с вопросами о подтверждении очистки. Они реализованы через `ПоказатьВопрос`.
	- И снова для информирования пользователя, что дерево пустое (в случае, если дерево на форме пустое) на клиенте была добавлена проверка на пустоту дерева с выводом информационного сообщения соответствующего содержания.
## Краткое описание алгоритмов формирования дерева *(оформляется)*
## Что улучшить? (Бэклог)
Отображение одиночной цифры `Ноль` в выводе чисел дерева на форме 
## Краткое описание модулей и методов *(оформляется)*
## Описание пользовательского интерфейса
Интерфейс пользователя состоит из следующих элементов:

![2023-06-19_21-51](https://github.com/anton-petrunov/1C-nevskiy-test/assets/97449490/31af32dc-381f-4015-b2f5-0ca5e9a0f14e)
1. Область с данными дерева
2. Переключатель (тумблер) `Группировать результат`. Позволяет выбрать поле, по которому будет сгруппировано выходное дерево
3. Надпись `Дата выполнения`. Показывает текущую дату
4. Подменю `Заполнить дерево`
5. Кнопка `Сортировать дерево`. Нажатие этой кнопки приводит к упорядочиванию дерева *по возрастанию* по тому полю, по которому уже выполнена группировка
6. Подменю `Очистить дерево`
   
Подменю `Заполнить дерево` включает в себя следующие кнопки:

![2023-10-18_08-38](https://github.com/anton-petrunov/1C-nevskiy-test/assets/97449490/71371bb3-b0b9-4709-aee8-5dab53181959)

1. Кнопка `Заполнить дерево`. Нажатие на эту кнопку приводит к заполнению дерева по улучшенному и быстрому алгоритму
2. Кнопка `Заполнить дерево, используя соответствие`, нажатие на которую приводит к заполнению дерева по менее оптимальному алгоритму

В подменю `Очистить дерево` включены следующие кнопки:

![2023-10-18_08-39](https://github.com/anton-petrunov/1C-nevskiy-test/assets/97449490/a784dba3-dd69-41ff-91d5-5fb8913bb5b0)

1. Кнопка `Очистить дерево (все данные на сервере)`. Происходит **полная** очистка дерева с вызовом сервера. При этом вызывается диалоговое окно с необходимостью подтвердить очистку дерева.
2. Кнопка `Очистить дерево (только форма на клиенте)`. Происходит **только** быстрая очистка формы на клиенте. Данные с сервера не удаляются. Но т.к. программа не использует информационную базу для записи данных, то при таком виде удаления вернуть старые данные не получится. При этом также вызывается диалоговое окно с необходимостью подтвердить очистку дерева.
## Примеры использования *(оформляется)*
## Архив всех выгрузок базы данных, сделанных во время работы над заданием (21 файл в архиве)
[Тестовое_Невский.zip](https://github.com/anton-petrunov/1C-nevskiy-test/files/12995712/_.zip)
